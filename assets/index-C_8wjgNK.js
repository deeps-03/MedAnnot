import{r as k,a as Ie,c as Fe,L as Oe,C as Ne,R as je,S as Ue,b as Te,I as Be,g as qe,d as Le,e as _e}from"./vendor-C2S0RA6C.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))l(m);new MutationObserver(m=>{for(const d of m)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function p(m){const d={};return m.integrity&&(d.integrity=m.integrity),m.referrerPolicy&&(d.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?d.credentials="include":m.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(m){if(m.ep)return;m.ep=!0;const d=p(m);fetch(m.href,d)}})();var pe={exports:{}},te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Me=k,Ce=Symbol.for("react.element"),Re=Symbol.for("react.fragment"),ze=Object.prototype.hasOwnProperty,Je=Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$e={key:!0,ref:!0,__self:!0,__source:!0};function ye(c,s,p){var l,m={},d=null,f=null;p!==void 0&&(d=""+p),s.key!==void 0&&(d=""+s.key),s.ref!==void 0&&(f=s.ref);for(l in s)ze.call(s,l)&&!$e.hasOwnProperty(l)&&(m[l]=s[l]);if(c&&c.defaultProps)for(l in s=c.defaultProps,s)m[l]===void 0&&(m[l]=s[l]);return{$$typeof:Ce,type:c,key:d,ref:f,props:m,_owner:Je.current}}te.Fragment=Re;te.jsx=ye;te.jsxs=ye;pe.exports=te;var h=pe.exports,ve,ge=Ie;ve=ge.createRoot,ge.hydrateRoot;const He={BASE_URL:"/MedAnnot/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function We(c,s){let p;try{p=c()}catch{return}return{getItem:m=>{var d;const f=u=>u===null?null:JSON.parse(u,void 0),o=(d=p.getItem(m))!=null?d:null;return o instanceof Promise?o.then(f):f(o)},setItem:(m,d)=>p.setItem(m,JSON.stringify(d,void 0)),removeItem:m=>p.removeItem(m)}}const G=c=>s=>{try{const p=c(s);return p instanceof Promise?p:{then(l){return G(l)(p)},catch(l){return this}}}catch(p){return{then(l){return this},catch(l){return G(l)(p)}}}},Ge=(c,s)=>(p,l,m)=>{let d={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:x=>x,version:0,merge:(x,S)=>({...S,...x}),...s},f=!1;const o=new Set,u=new Set;let y;try{y=d.getStorage()}catch{}if(!y)return c((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),p(...x)},l,m);const E=G(d.serialize),D=()=>{const x=d.partialize({...l()});let S;const v=E({state:x,version:d.version}).then(I=>y.setItem(d.name,I)).catch(I=>{S=I});if(S)throw S;return v},F=m.setState;m.setState=(x,S)=>{F(x,S),D()};const O=c((...x)=>{p(...x),D()},l,m);let B;const w=()=>{var x;if(!y)return;f=!1,o.forEach(v=>v(l()));const S=((x=d.onRehydrateStorage)==null?void 0:x.call(d,l()))||void 0;return G(y.getItem.bind(y))(d.name).then(v=>{if(v)return d.deserialize(v)}).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==d.version){if(d.migrate)return d.migrate(v.state,v.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return v.state}).then(v=>{var I;return B=d.merge(v,(I=l())!=null?I:O),p(B,!0),D()}).then(()=>{S==null||S(B,void 0),f=!0,u.forEach(v=>v(B))}).catch(v=>{S==null||S(void 0,v)})};return m.persist={setOptions:x=>{d={...d,...x},x.getStorage&&(y=x.getStorage())},clearStorage:()=>{y==null||y.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>w(),hasHydrated:()=>f,onHydrate:x=>(o.add(x),()=>{o.delete(x)}),onFinishHydration:x=>(u.add(x),()=>{u.delete(x)})},w(),B||O},Ze=(c,s)=>(p,l,m)=>{let d={storage:We(()=>localStorage),partialize:w=>w,version:0,merge:(w,x)=>({...x,...w}),...s},f=!1;const o=new Set,u=new Set;let y=d.storage;if(!y)return c((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),p(...w)},l,m);const E=()=>{const w=d.partialize({...l()});return y.setItem(d.name,{state:w,version:d.version})},D=m.setState;m.setState=(w,x)=>{D(w,x),E()};const F=c((...w)=>{p(...w),E()},l,m);m.getInitialState=()=>F;let O;const B=()=>{var w,x;if(!y)return;f=!1,o.forEach(v=>{var I;return v((I=l())!=null?I:F)});const S=((x=d.onRehydrateStorage)==null?void 0:x.call(d,(w=l())!=null?w:F))||void 0;return G(y.getItem.bind(y))(d.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==d.version){if(d.migrate)return[!0,d.migrate(v.state,v.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var I;const[Z,N]=v;if(O=d.merge(N,(I=l())!=null?I:F),p(O,!0),Z)return E()}).then(()=>{S==null||S(O,void 0),O=l(),f=!0,u.forEach(v=>v(O))}).catch(v=>{S==null||S(void 0,v)})};return m.persist={setOptions:w=>{d={...d,...w},w.storage&&(y=w.storage)},clearStorage:()=>{y==null||y.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>B(),hasHydrated:()=>f,onHydrate:w=>(o.add(w),()=>{o.delete(w)}),onFinishHydration:w=>(u.add(w),()=>{u.delete(w)})},d.skipHydration||B(),O||F},Ye=(c,s)=>"getStorage"in s||"serialize"in s||"deserialize"in s?((He?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ge(c,s)):Ze(c,s),Xe=Ye,z=Fe()(Xe(c=>({isDarkMode:!1,toggleDarkMode:()=>c(s=>({isDarkMode:!s.isDarkMode})),currentImage:null,setCurrentImage:s=>c({currentImage:s}),metadata:null,setMetadata:s=>c({metadata:s}),annotations:[],addAnnotation:s=>c(p=>({annotations:[...p.annotations,s]})),removeAnnotation:s=>c(p=>({annotations:p.annotations.filter(l=>l.id!==s)})),zoom:1,setZoom:s=>c({zoom:s}),currentTool:"move",setTool:s=>c({currentTool:s}),brightness:0,setBrightness:s=>c({brightness:s}),contrast:1,setContrast:s=>c({contrast:s})}),{name:"medannot-storage",partialize:c=>({isDarkMode:c.isDarkMode,currentTool:c.currentTool})}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),T=(c,s)=>{const p=k.forwardRef(({color:l="currentColor",size:m=24,strokeWidth:d=2,absoluteStrokeWidth:f,className:o="",children:u,...y},E)=>k.createElement("svg",{ref:E,...Qe,width:m,height:m,stroke:l,strokeWidth:f?Number(d)*24/Number(m):d,className:["lucide",`lucide-${Ke(c)}`,o].join(" "),...y},[...s.map(([D,F])=>k.createElement(D,F)),...Array.isArray(u)?u:[u]]));return p.displayName=`${c}`,p};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=T("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=T("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=T("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=T("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=T("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=T("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=T("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=T("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=T("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=T("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=T("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),ct=()=>{const{isDarkMode:c,toggleDarkMode:s,zoom:p,setZoom:l,setTool:m,currentTool:d}=z(),f=[{icon:tt,name:"move",title:"Pan"},{icon:rt,name:"draw",title:"Draw"},{icon:it,name:"rectangle",title:"Rectangle"},{icon:Ve,name:"circle",title:"Circle"},{icon:nt,name:"measure",title:"Measure"}];return h.jsxs("div",{className:"fixed left-4 top-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-lg flex flex-col gap-2",children:[h.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Toggle dark mode",children:c?h.jsx(ot,{size:20,className:"text-gray-200"}):h.jsx(et,{size:20})}),h.jsx("div",{className:"w-full h-px bg-gray-200 dark:bg-gray-700"}),h.jsx("button",{onClick:()=>l(p+.1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Zoom in",children:h.jsx(dt,{size:20,className:"dark:text-gray-200"})}),h.jsx("button",{onClick:()=>l(Math.max(.1,p-.1)),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Zoom out",children:h.jsx(lt,{size:20,className:"dark:text-gray-200"})}),h.jsx("div",{className:"w-full h-px bg-gray-200 dark:bg-gray-700"}),f.map(({icon:o,name:u,title:y})=>h.jsx("button",{onClick:()=>m(u),className:`p-2 rounded-lg transition-colors ${d===u?"bg-blue-100 dark:bg-blue-900":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:y,children:h.jsx(o,{size:20,className:"dark:text-gray-200"})},u)),h.jsx("div",{className:"w-full h-px bg-gray-200 dark:bg-gray-700"}),h.jsx("button",{onClick:()=>{l(1),m("move")},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Reset view",children:h.jsx(at,{size:20,className:"dark:text-gray-200"})})]})},ft=c=>new Promise((s,p)=>{const l=new FileReader;l.onload=()=>{typeof l.result=="string"?s(l.result):p(new Error("Failed to read file"))},l.onerror=()=>{p(new Error("Failed to read file"))},l.readAsDataURL(c)}),ut=c=>new Promise((s,p)=>{const l=new Image;l.onload=()=>s(l),l.onerror=()=>p(new Error("Failed to load image")),l.src=c}),mt=c=>{const[s,p]=k.useState(null),[l,m]=k.useState(!1),[d,f]=k.useState(null);return k.useEffect(()=>{if(!c){p(null);return}(async()=>{m(!0),f(null);try{const u=await ut(c);p(u)}catch(u){f(u instanceof Error?u.message:"Failed to load image"),p(null)}finally{m(!1)}})()},[c]),{imageElement:s,loading:l,error:d}},ht=()=>{const[c,s]=k.useState({x:0,y:0,scaleX:1,scaleY:1}),p=k.useCallback(d=>{d.evt.preventDefault();const f=1.1,o=c.scaleX,u=d.getPointerPosition();if(!u)return;const y={x:(u.x-c.x)/o,y:(u.y-c.y)/o},E=d.evt.deltaY<0?o*f:o/f;s({x:u.x-y.x*E,y:u.y-y.y*E,scaleX:E,scaleY:E})},[c]),l=k.useCallback(d=>{const f=d.target.position();s(o=>({...o,x:f.x,y:f.y}))},[]),m=k.useCallback(d=>{const f=d.target.position();s(o=>({...o,x:f.x,y:f.y}))},[]);return{transform:c,handleWheel:p,handleDragStart:l,handleDragMove:m}},gt=()=>{const{annotations:c}=z();return h.jsx(h.Fragment,{children:c.map(s=>{switch(s.type){case"rectangle":return h.jsx(je,{x:s.points[0],y:s.points[1],width:s.points[2],height:s.points[3],stroke:s.color,strokeWidth:2},s.id);case"ellipse":return h.jsx(Ne,{x:s.points[0],y:s.points[1],radiusX:s.points[2],radiusY:s.points[3],stroke:s.color,strokeWidth:2},s.id);case"line":return h.jsx(Oe,{points:s.points,stroke:s.color,strokeWidth:2},s.id);default:return null}})})},pt=()=>h.jsx("div",{className:"flex items-center justify-center h-full",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"})}),yt=()=>{const c=k.useRef(null),[s,p]=k.useState({width:0,height:0}),{currentImage:l}=z(),{imageElement:m,loading:d,error:f}=mt(l),{transform:o,handleWheel:u,handleDragStart:y,handleDragMove:E}=ht();return k.useEffect(()=>{const D=()=>{c.current&&p({width:c.current.clientWidth,height:c.current.clientHeight})};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),d?h.jsx(pt,{}):f||!l?h.jsx("div",{className:"flex items-center justify-center h-full",children:h.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:f||"No image loaded. Upload an image file to begin."})}):h.jsx("div",{className:"relative w-full h-full",ref:c,children:h.jsx(Ue,{width:s.width,height:s.height,onWheel:u,onDragStart:y,onDragMove:E,draggable:!0,children:h.jsxs(Te,{children:[m&&h.jsx(Be,{image:m,x:o.x,y:o.y,scaleX:o.scaleX,scaleY:o.scaleY}),h.jsx(gt,{})]})})})},vt=()=>{const{metadata:c}=z();return c?h.jsxs("div",{className:"fixed right-0 top-0 h-full w-64 bg-white dark:bg-gray-800 shadow-lg p-4 overflow-y-auto",children:[h.jsx("h2",{className:"text-lg font-semibold mb-4 dark:text-white",children:"DICOM Metadata"}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Patient Name"}),h.jsx("p",{className:"dark:text-white",children:c.patientName||"N/A"})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Patient ID"}),h.jsx("p",{className:"dark:text-white",children:c.patientId||"N/A"})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Study Date"}),h.jsx("p",{className:"dark:text-white",children:c.studyDate||"N/A"})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Modality"}),h.jsx("p",{className:"dark:text-white",children:c.modality||"N/A"})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Pixel Spacing"}),h.jsx("p",{className:"dark:text-white",children:c.pixelSpacing?`${c.pixelSpacing[0]} mm x ${c.pixelSpacing[1]} mm`:"N/A"})]}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Window Settings"}),h.jsxs("p",{className:"dark:text-white",children:["C: ",c.windowCenter||"N/A"," / W: ",c.windowWidth||"N/A"]})]})]})]}):null};var xe={exports:{}};const xt={},bt=Object.freeze(Object.defineProperty({__proto__:null,default:xt},Symbol.toStringTag,{value:"Module"})),wt=qe(bt);/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */(function(c,s){(function(p,l){c.exports=l(wt)})(Le,function(p){return m=[function(f,o){f.exports=p},function(f,o,u){u.r(o),u.d(o,"isStringVr",function(){return E}),u.d(o,"isPrivateTag",function(){return D}),u.d(o,"parsePN",function(){return F}),u.d(o,"parseTM",function(){return O}),u.d(o,"parseDA",function(){return w}),u.d(o,"explicitElementToString",function(){return x}),u.d(o,"explicitDataSetToJS",function(){return S}),u.d(o,"createJPEGBasicOffsetTable",function(){return Z}),u.d(o,"parseDicomDataSetExplicit",function(){return K}),u.d(o,"parseDicomDataSetImplicit",function(){return V}),u.d(o,"readFixedString",function(){return C}),u.d(o,"alloc",function(){return H}),u.d(o,"version",function(){return fe}),u.d(o,"bigEndianByteArrayParser",function(){return ne}),u.d(o,"ByteStream",function(){return L}),u.d(o,"sharedCopy",function(){return W}),u.d(o,"DataSet",function(){return q}),u.d(o,"findAndSetUNElementLength",function(){return de}),u.d(o,"findEndOfEncapsulatedElement",function(){return re}),u.d(o,"findItemDelimitationItemAndSetElementLength",function(){return Y}),u.d(o,"littleEndianByteArrayParser",function(){return _}),u.d(o,"parseDicom",function(){return ue}),u.d(o,"readDicomElementExplicit",function(){return $}),u.d(o,"readDicomElementImplicit",function(){return X}),u.d(o,"readEncapsulatedImageFrame",function(){return oe}),u.d(o,"readEncapsulatedPixelData",function(){return he}),u.d(o,"readEncapsulatedPixelDataFromFragments",function(){return ee}),u.d(o,"readPart10Header",function(){return ie}),u.d(o,"readSequenceItemsExplicit",function(){return ae}),u.d(o,"readSequenceItemsImplicit",function(){return Q}),u.d(o,"readSequenceItem",function(){return J}),u.d(o,"readTag",function(){return N});var y={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},E=function(e){return y[e]},D=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},F=function(e){if(e!==void 0)return e=e.split("^"),{familyName:e[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function O(e,r){if(2<=e.length){var a=parseInt(e.substring(0,2),10),t=4<=e.length?parseInt(e.substring(2,4),10):void 0,n=6<=e.length?parseInt(e.substring(4,6),10):void 0,i=8<=e.length?e.substring(7,13):void 0,i=i?parseInt(i,10)*Math.pow(10,6-i.length):void 0;if(r&&(isNaN(a)||t!==void 0&&isNaN(t)||n!==void 0&&isNaN(n)||i!==void 0&&isNaN(i)||a<0||23<a||t&&(t<0||59<t)||n&&(n<0||59<n)||i&&(i<0||999999<i)))throw"invalid TM '".concat(e,"'");return{hours:a,minutes:t,seconds:n,fractionalSeconds:i}}if(r)throw"invalid TM '".concat(e,"'")}function B(e,r,a){return!isNaN(a)&&0<r&&r<=12&&0<e&&e<=function(t,n){switch(t){case 2:return n%4==0&&n%100||n%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(r,a)}function w(e,r){if(e&&e.length===8){var a=parseInt(e.substring(0,4),10),t=parseInt(e.substring(4,6),10),n=parseInt(e.substring(6,8),10);if(r&&B(n,t,a)!==!0)throw"invalid DA '".concat(e,"'");return{year:a,month:t,day:n}}if(r)throw"invalid DA '".concat(e,"'")}function x(e,r){if(e===void 0||r===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(r.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var a,t=r.vr,n=r.tag;function i(b,P){for(var j="",A=0;A<b;A++)A!==0&&(j+="/"),j+=P.call(e,n,A).toString();return j}if(E(t)===!0)a=e.string(n);else{if(t==="AT"){var g=e.uint32(n);return g===void 0?void 0:"x".concat((g=g<0?4294967295+g+1:g).toString(16).toUpperCase())}t==="US"?a=i(r.length/2,e.uint16):t==="SS"?a=i(r.length/2,e.int16):t==="UL"?a=i(r.length/4,e.uint32):t==="SL"?a=i(r.length/4,e.int32):t==="FD"?a=i(r.length/8,e.double):t==="FL"&&(a=i(r.length/4,e.float))}return a}function S(e,r){if(e===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";r=r||{omitPrivateAttibutes:!0,maxElementLength:128};var a,t={};for(a in e.elements){var n=e.elements[a];if(r.omitPrivateAttibutes!==!0||!D(a))if(n.items){for(var i=[],g=0;g<n.items.length;g++)i.push(S(n.items[g].dataSet,r));t[a]=i}else{var b=void 0;n.length<r.maxElementLength&&(b=x(e,n)),t[a]=b!==void 0?b:{dataOffset:n.dataOffset,length:n.length}}}return t}function v(e,r){return e.byteArray[r]===255&&e.byteArray[r+1]===217}function I(e,r,a){for(var t,n,i=a;i<r.fragments.length;i++)if(t=e,n=i,n=r.fragments[n],!(!v(t,n.position+n.length-2)&&!v(t,n.position+n.length-3)))return i}function Z(e,r,a){if(e===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(r===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(r.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(r.encapsulatedPixelData!==!0||r.hadUndefinedLength!==!0||r.basicOffsetTable===void 0||r.fragments===void 0||r.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(a&&a.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";a=a||r.fragments;for(var t=[],n=0;;){t.push(r.fragments[n].offset);var i=I(e,r,n);if(i===void 0||i===r.fragments.length-1)return t;n=i+1}}function N(a){if(a===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var r=256*a.readUint16()*256,a=a.readUint16();return"x".concat("00000000".concat((r+a).toString(16)).substr(-8))}function re(e,r,a){if(e===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(r===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(r.encapsulatedPixelData=!0,r.basicOffsetTable=[],r.fragments=[],N(e)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var t=e.readUint32()/4,n=0;n<t;n++){var i=e.readUint32();r.basicOffsetTable.push(i)}for(var g=e.position;e.position<e.byteArray.length;){var b=N(e),P=e.readUint32();if(b==="xfffee0dd")return e.seek(P),void(r.length=e.position-r.dataOffset);if(b!=="xfffee000")return a&&a.push("unexpected tag ".concat(b," while searching for end of pixel data element with undefined length")),P>e.byteArray.length-e.position&&(P=e.byteArray.length-e.position),r.fragments.push({offset:e.position-g-8,position:e.position,length:P}),e.seek(P),void(r.length=e.position-r.dataOffset);r.fragments.push({offset:e.position-g-8,position:e.position,length:P}),e.seek(P)}a&&a.push("pixel data element ".concat(r.tag," missing sequence delimiter tag xfffee0dd"))}function de(e,r){if(e===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var a=e.byteArray.length-8;e.position<=a;)if(e.readUint16()===65534){var t=e.readUint16();if(t===57565)return e.readUint32()!==0&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(r.tag)),void(r.length=e.position-r.dataOffset)}r.length=e.byteArray.length-r.dataOffset,e.seek(e.byteArray.length-e.position)}function C(e,r,a){if(a<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(r+a>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var t,n="",i=0;i<a;i++){if((t=e[r+i])===0)return r+=a,n;n+=String.fromCharCode(t)}return n}function be(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function R(e,r){return e.parser!==void 0?e.parser:r}var q=function(){function e(t,n,i){(function(g,b){if(!(g instanceof b))throw new TypeError("Cannot call a class as a function")})(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=i}var r,a;return r=e,(a=[{key:"uint16",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readUint16(this.byteArray,t.dataOffset+2*n)}},{key:"int16",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readInt16(this.byteArray,t.dataOffset+2*n)}},{key:"uint32",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readUint32(this.byteArray,t.dataOffset+4*n)}},{key:"int32",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readInt32(this.byteArray,t.dataOffset+4*n)}},{key:"float",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readFloat(this.byteArray,t.dataOffset+4*n)}},{key:"double",value:function(t,n){if(t=this.elements[t],n=n!==void 0?n:0,t&&t.length!==0)return R(t,this.byteArrayParser).readDouble(this.byteArray,t.dataOffset+8*n)}},{key:"numStringValues",value:function(t){if(t=this.elements[t],t&&0<t.length)return t=C(this.byteArray,t.dataOffset,t.length).match(/\\/g),t===null?1:t.length+1}},{key:"string",value:function(t,n){if(t=this.elements[t],t&&t.Value)return t.Value;if(t&&0<t.length)return t=C(this.byteArray,t.dataOffset,t.length),0<=n?t.split("\\")[n].trim():t.trim()}},{key:"text",value:function(t,n){if(t=this.elements[t],t&&0<t.length)return t=C(this.byteArray,t.dataOffset,t.length),0<=n?t.split("\\")[n].replace(/ +$/,""):t.replace(/ +$/,"")}},{key:"floatString",value:function(t,n){var i=this.elements[t];if(i&&0<i.length&&(n=this.string(t,n=n!==void 0?n:0),n!==void 0))return parseFloat(n)}},{key:"intString",value:function(t,n){var i=this.elements[t];if(i&&0<i.length&&(n=this.string(t,n=n!==void 0?n:0),n!==void 0))return parseInt(n)}},{key:"attributeTag",value:function(t){var n=this.elements[t];if(n&&n.length===4){var i=R(n,this.byteArrayParser).readUint16,t=this.byteArray,n=n.dataOffset;return"x".concat("00000000".concat((256*i(t,n)*256+i(t,n+2)).toString(16)).substr(-8))}}}])&&be(r.prototype,a),Object.defineProperty(r,"prototype",{writable:!1}),e}();function Y(e,r){if(e===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var a=e.byteArray.length-8;e.position<=a;)if(e.readUint16()===65534){var t=e.readUint16();if(t===57357)return e.readUint32()!==0&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(r.tag)),void(r.length=e.position-r.dataOffset)}r.length=e.byteArray.length-r.dataOffset,e.seek(e.byteArray.length-e.position)}var we=function(e,r){return e.vr!==void 0?e.vr==="SQ":r.position+4<=r.byteArray.length?(e=N(r),r.seek(-4),e==="xfffee000"||e==="xfffee0dd"):(r.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function X(e,r,a){if(e===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var t=N(e),t={tag:t,vr:a!==void 0?a(t):void 0,length:e.readUint32(),dataOffset:e.position};return t.length===4294967295&&(t.hadUndefinedLength=!0),t.tag===r||(!we(t,e)||D(t.tag)&&!t.hadUndefinedLength?t.hadUndefinedLength?Y(e,t):e.seek(t.length):(Q(e,t,a),D(t.tag)&&(t.items=void 0))),t}function J(e){if(e===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var r={tag:N(e),length:e.readUint32(),dataOffset:e.position};if(r.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return r}function le(e,r){var a=J(e);return a.length===4294967295?(a.hadUndefinedLength=!0,a.dataSet=function(t,n){for(var i={};t.position<t.byteArray.length;){var g=X(t,void 0,n);if((i[g.tag]=g).tag==="xfffee00d")return new q(t.byteArrayParser,t.byteArray,i)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new q(t.byteArrayParser,t.byteArray,i)}(e,r),a.length=e.position-a.dataOffset):(a.dataSet=new q(e.byteArrayParser,e.byteArray,{}),V(a.dataSet,e,e.position+a.length,{vrCallback:r})),a}function Q(e,r,a){if(e===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(r===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";r.items=[],(r.length===4294967295?function(t,n,i){for(;t.position+4<=t.byteArray.length;){var g=N(t);if(t.seek(-4),g==="xfffee0dd")return n.length=t.position-n.dataOffset,t.seek(8);g=le(t,i),n.items.push(g)}t.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),n.length=t.byteArray.length-n.dataOffset}:function(t,n,i){for(var g=n.dataOffset+n.length;t.position<g;){var b=le(t,i);n.items.push(b)}})(e,r,a)}function ce(e,r){var a=J(e);return a.length===4294967295?(a.hadUndefinedLength=!0,a.dataSet=function(t,n){for(var i={};t.position<t.byteArray.length;){var g=$(t,n);if((i[g.tag]=g).tag==="xfffee00d")return new q(t.byteArrayParser,t.byteArray,i)}return n.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new q(t.byteArrayParser,t.byteArray,i)}(e,r),a.length=e.position-a.dataOffset):(a.dataSet=new q(e.byteArrayParser,e.byteArray,{}),K(a.dataSet,e,e.position+a.length)),a}function ae(e,r,a){if(e===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(r===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";r.items=[],(r.length===4294967295?function(t,n,i){for(;t.position+4<=t.byteArray.length;){var g=N(t);if(t.seek(-4),g==="xfffee0dd")return n.length=t.position-n.dataOffset,t.seek(8);g=ce(t,i),n.items.push(g)}i.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),n.length=t.position-n.dataOffset}:function(t,n,i){for(var g=n.dataOffset+n.length;t.position<g;){var b=ce(t,i);n.items.push(b)}})(e,r,a)}var Pe=function(e){return e==="OB"||e==="OD"||e==="OL"||e==="OW"||e==="SQ"||e==="OF"||e==="UC"||e==="UR"||e==="UT"||e==="UN"?4:2};function $(e,r,a){if(e===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var t={tag:N(e),vr:e.readFixedString(2)};return Pe(t.vr)===2?t.length=e.readUint16():(e.seek(2),t.length=e.readUint32()),t.dataOffset=e.position,t.length===4294967295&&(t.hadUndefinedLength=!0),t.tag===a||(t.vr==="SQ"?ae(e,t,r):t.length===4294967295?t.tag==="x7fe00010"?re(e,t,r):(t.vr==="UN"?Q:Y)(e,t):e.seek(t.length)),t}function K(e,r,a){var t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(a=a===void 0?r.byteArray.length:a,r===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(a<r.position||a>r.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var n=e.elements;r.position<a;){var i=$(r,e.warnings,t.untilTag);if((n[i.tag]=i).tag===t.untilTag)return}if(r.position>a)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function V(e,r,a){var t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(a=a===void 0?e.byteArray.length:a,r===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(a<r.position||a>r.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var n=e.elements;r.position<a;){var i=X(r,t.untilTag,t.vrCallback);if((n[i.tag]=i).tag===t.untilTag)return}}function H(e,r){if(typeof Buffer<"u"&&e instanceof Buffer)return Buffer.alloc(r);if(e instanceof Uint8Array)return new Uint8Array(r);throw"dicomParser.alloc: unknown type for byteArray"}var fe="1.8.12",ne={readUint16:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(r+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[r]<<8)+e[r+1]},readInt16:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(r+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return r=(e[r]<<8)+e[r+1],r=32768&r?r-65535-1:r},readUint32:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(r+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[r]+e[r+1])+e[r+2])+e[r+3]},readInt32:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(r+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3]},readFloat:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(r+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var a=new Uint8Array(4);return a[3]=e[r],a[2]=e[r+1],a[1]=e[r+2],a[0]=e[r+3],new Float32Array(a.buffer)[0]},readDouble:function(e,r){if(r<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(r+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var a=new Uint8Array(8);return a[7]=e[r],a[6]=e[r+1],a[5]=e[r+2],a[4]=e[r+3],a[3]=e[r+4],a[2]=e[r+5],a[1]=e[r+6],a[0]=e[r+7],new Float64Array(a.buffer)[0]}};function W(e,r,a){if(typeof Buffer<"u"&&e instanceof Buffer)return e.slice(r,r+a);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+r,a);throw"dicomParser.from: unknown type for byteArray"}function Ee(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var L=function(){function e(t,n,i){if(function(g,b){if(!(g instanceof b))throw new TypeError("Cannot call a class as a function")}(this,e),t===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(n===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(n instanceof Uint8Array)&&(typeof Buffer>"u"||!(n instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=n,this.position=i||0,this.warnings=[]}var r,a;return r=e,(a=[{key:"seek",value:function(t){if(this.position+t<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=t}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=W(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,n)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var t=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,t}},{key:"readUint32",value:function(){var t=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,t}},{key:"readFixedString",value:function(t){var n=C(this.byteArray,this.position,t);return this.position+=t,n}}])&&Ee(r.prototype,a),Object.defineProperty(r,"prototype",{writable:!1}),e}(),_={readUint16:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(r+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[r]+256*e[r+1]},readInt16:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(r+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return r=e[r]+(e[r+1]<<8),r=32768&r?r-65535-1:r},readUint32:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(r+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[r]+256*e[r+1]+256*e[r+2]*256+256*e[r+3]*256*256},readInt32:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(r+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24)},readFloat:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(r+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var a=new Uint8Array(4);return a[0]=e[r],a[1]=e[r+1],a[2]=e[r+2],a[3]=e[r+3],new Float32Array(a.buffer)[0]},readDouble:function(e,r){if(r<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(r+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var a=new Uint8Array(8);return a[0]=e[r],a[1]=e[r+1],a[2]=e[r+2],a[3]=e[r+3],a[4]=e[r+4],a[5]=e[r+5],a[6]=e[r+6],a[7]=e[r+7],new Float64Array(a.buffer)[0]}};function ie(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(e===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var a=r.TransferSyntaxUID,t=new L(_,e);return function(){var n=function(){if(t.getSize()<=132&&a)return!1;if(t.seek(128),t.readFixedString(4)==="DICM")return!0;if(!(r||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return t.seek(0),!1}(),i=[],g={};if(!n)return t.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:a}},warnings:i};for(;t.position<t.byteArray.length;){var b=t.position,P=$(t,i);if("x0002ffff"<P.tag){t.position=b;break}P.parser=_,g[P.tag]=P}return(n=new q(t.byteArrayParser,t.byteArray,g)).warnings=t.warnings,n.position=t.position,n}()}var Se="1.2.840.10008.1.2.2";function ue(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(e===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var a,t=function(i){if(i.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return i=i.elements.x00020010,i&&i.Value||C(e,i.dataOffset,i.length)};function n(P){var b=t(P),g=b!=="1.2.840.10008.1.2",b=function(j,A){var se=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(j!=="1.2.840.10008.1.2.1.99")return new L(j===Se?ne:_,e,A);if(r&&r.inflater)return j=r.inflater(e,A),new L(_,j,0);if(se==!0){var U=u(0),M=W(e,A,e.length-A),U=U.inflateRawSync(M),M=H(e,U.length+A);return e.copy(M,0,0,A),U.copy(M,A),new L(_,M,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return U=e.slice(A),M=pako.inflateRaw(U),(U=H(e,M.length+A)).set(e.slice(0,A),0),U.set(M,A),new L(_,U,0)}(b,P.position),P=new q(b.byteArrayParser,b.byteArray,{});P.warnings=b.warnings;try{(g?K:V)(P,b,b.byteArray.length,r)}catch(j){throw{exception:j,dataSet:P}}return P}return function(i,g){for(var b in i.elements)i.elements.hasOwnProperty(b)&&(g.elements[b]=i.elements[b]);return i.warnings!==void 0&&(g.warnings=i.warnings.concat(g.warnings)),g}(a=ie(e,r),n(a))}var Ae=function(e,r,a){for(var t=0,n=r;n<r+a;n++)t+=e[n].length;return t};function ee(e,g,a,t,n){if(n=n||g.fragments,e===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(g===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(a===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((t=t||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(g.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(g.encapsulatedPixelData!==!0||g.hadUndefinedLength!==!0||g.basicOffsetTable===void 0||g.fragments===void 0||g.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(a<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(a>=g.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(t<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(a+t>g.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var i=new L(e.byteArrayParser,e.byteArray,g.dataOffset),g=J(i);if(g.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";i.seek(g.length);var b=i.position;if(t===1)return W(i.byteArray,b+n[a].offset+8,n[a].length);for(var g=Ae(n,a,t),P=H(i.byteArray,g),j=0,A=a;A<a+t;A++)for(var se=b+n[A].offset+8,U=0;U<n[A].length;U++)P[j++]=i.byteArray[se++];return P}var ke=function(e,r){for(var a=0;a<e.length;a++)if(e[a].offset===r)return a},De=function(e,r,a,t){if(e===r.length-1)return a.length-t;for(var n=r[e+1],i=t+1;i<a.length;i++)if(a[i].offset===n)return i-t;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function oe(e,r,a,t,n){if(t=t||r.basicOffsetTable,n=n||r.fragments,e===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(r===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(a===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(t===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(r.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(r.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(r.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(t.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(a<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(a>=t.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var i=t[a],i=ke(n,i);if(i===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return ee(e,r,i,De(a,t,n,i),n)}var me=!1;function he(e,r,a){if(me||(me=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),e===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(r===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(a===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(r.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(r.encapsulatedPixelData!==!0||r.hadUndefinedLength!==!0||r.basicOffsetTable===void 0||r.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(a<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return r.basicOffsetTable.length!==0?oe(e,r,a):ee(e,r,0,r.fragments.length)}o.default={isStringVr:E,isPrivateTag:D,parsePN:F,parseTM:O,parseDA:w,explicitElementToString:x,explicitDataSetToJS:S,createJPEGBasicOffsetTable:Z,parseDicomDataSetExplicit:K,parseDicomDataSetImplicit:V,readFixedString:C,alloc:H,version:fe,bigEndianByteArrayParser:ne,ByteStream:L,sharedCopy:W,DataSet:q,findAndSetUNElementLength:de,findEndOfEncapsulatedElement:re,findItemDelimitationItemAndSetElementLength:Y,littleEndianByteArrayParser:_,parseDicom:ue,readDicomElementExplicit:$,readDicomElementImplicit:X,readEncapsulatedImageFrame:oe,readEncapsulatedPixelData:he,readEncapsulatedPixelDataFromFragments:ee,readPart10Header:ie,readSequenceItemsExplicit:ae,readSequenceItemsImplicit:Q,readSequenceItem:J,readTag:N,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],d={},l.m=m,l.c=d,l.d=function(f,o,u){l.o(f,o)||Object.defineProperty(f,o,{enumerable:!0,get:u})},l.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},l.t=function(f,o){if(1&o&&(f=l(f)),8&o||4&o&&typeof f=="object"&&f&&f.__esModule)return f;var u=Object.create(null);if(l.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:f}),2&o&&typeof f!="string")for(var y in f)l.d(u,y,(function(E){return f[E]}).bind(null,y));return u},l.n=function(f){var o=f&&f.__esModule?function(){return f.default}:function(){return f};return l.d(o,"a",o),o},l.o=function(f,o){return Object.prototype.hasOwnProperty.call(f,o)},l.p="",l(l.s=1);function l(f){if(d[f])return d[f].exports;var o=d[f]={i:f,l:!1,exports:{}};return m[f].call(o.exports,o,o.exports,l),o.l=!0,o.exports}var m,d})})(xe);var Pt=xe.exports;const Et=_e(Pt),St=async c=>new Promise((s,p)=>{const l=new FileReader;l.onload=m=>{var d,f;try{if(!((d=m.target)!=null&&d.result))throw new Error("Failed to read file");const o=m.target.result,u=new Uint8Array(o),y=Et.parseDicom(u),E={patientName:y.string("x00100010"),patientId:y.string("x00100020"),studyDate:y.string("x00080020"),modality:y.string("x00080060"),pixelSpacing:(f=y.string("x00280030"))==null?void 0:f.split("\\").map(Number),windowCenter:Number(y.string("x00281050")),windowWidth:Number(y.string("x00281051"))};s(E)}catch{s({modality:"Unknown",studyDate:new Date().toISOString().split("T")[0]})}},l.onerror=()=>p(new Error("Error reading file")),l.readAsArrayBuffer(c)}),At=()=>{const{setCurrentImage:c,setMetadata:s}=z(),p=k.useCallback(async l=>{var d;const m=(d=l.target.files)==null?void 0:d[0];if(m)try{const f=await St(m);s(f);const o=await ft(m);c(o)}catch(f){console.error("Error loading file:",f),alert("Error loading file. Please ensure it's a valid image format.")}},[c,s]);return h.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-10",children:h.jsxs("label",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 px-4 py-2 rounded-lg shadow-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[h.jsx(st,{size:20,className:"dark:text-gray-200"}),h.jsx("span",{className:"text-sm font-medium dark:text-gray-200",children:"Upload Image"}),h.jsx("input",{type:"file",accept:"image/*,.dcm",onChange:p,className:"hidden"})]})})};function kt(){const{isDarkMode:c}=z();return k.useEffect(()=>{c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[c]),h.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors",children:h.jsxs("div",{className:"relative h-screen",children:[h.jsx(At,{}),h.jsx(ct,{}),h.jsx(yt,{}),h.jsx(vt,{})]})})}ve(document.getElementById("root")).render(h.jsx(k.StrictMode,{children:h.jsx(kt,{})}));
